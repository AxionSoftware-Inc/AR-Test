<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebXR Auto-Place Model</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <style>
        /* Sening kodingdagi uslublar */
        html, body { margin: 0; padding: 0; overflow: hidden; background: black; }
        
        #start {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            padding: 14px 22px; font-size: 18px; z-index: 10;
            background: rgba(255, 255, 255, 0.9); border: none; border-radius: 4px;
        }
    </style>
</head>
<body>

<button id="start">Start AR</button>

<script type="module">
    import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';

    let camera, scene, renderer;
    let model;

    // Tugma bosilganda ishga tushadi
    document.getElementById('start').addEventListener('click', initAR);

    async function initAR() {
        if (!navigator.xr) {
            alert("WebXR topilmadi (HTTPS va Chrome kerak)");
            return;
        }

        // 1. SAHNANI YARATAMIZ
        scene = new THREE.Scene();
        // ‚ö†Ô∏è ENG MUHIM JOYI: Sening kodingdagi "gl.clearColor(0,0,0,0)" analogi:
        scene.background = null; 

        // 2. KAMERA
        camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.01, 20);

        // 3. YORUG'LIK (Model qop-qora bo'lmasligi uchun)
        const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 3);
        light.position.set(0.5, 1, 0.25);
        scene.add(light);

        // 4. RENDERER (WebXR ni yoqamiz)
        renderer = new THREE.WebGLRenderer({ 
            antialias: true, 
            alpha: true // ‚ö†Ô∏è KAMERA OCHILISHI UCHUN SHART
        });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.xr.enabled = true; // WebXR aktivlashtiramiz
        
        // ‚ö†Ô∏è Sening kodingdagi "gl.clear" logikasi:
        renderer.setClearColor(0x000000, 0); 
        
        document.body.appendChild(renderer.domElement);

        // 5. MODEL YARATISH (Avtomatik)
        // Hozircha murakkab shakl (TorusKnot) yaratamiz, xuddi haqiqiy modeldek.
        const geometry = new THREE.TorusKnotGeometry(0.2, 0.05, 100, 16); 
        const material = new THREE.MeshStandardMaterial({ color: 0x00aaff, roughness: 0.1, metalness: 0.5 });
        model = new THREE.Mesh(geometry, material);

        // üìç JOYLASHTIRISH (Logika):
        // WebXR da boshlang'ich nuqta (0,0,0) - bu telefoning turgan joyi.
        // Biz modelni Z o'qi bo'yicha -1.5 metr (oldinga) suramiz.
        model.position.set(0, 0, -1.5);
        
        scene.add(model);

        // 6. SESSIYANI BOSHLASH
        const session = await navigator.xr.requestSession('immersive-ar', {
            requiredFeatures: ['local'] // 'local' bu 6DoF yurishni ta'minlaydi
        });

        renderer.xr.setReferenceSpaceType('local');
        renderer.xr.setSession(session);

        // Tugmani yo'qotamiz
        document.getElementById('start').style.display = 'none';

        // Render loop
        renderer.setAnimationLoop(render);
    }

    function render() {
        // Modelni sekin aylantiramiz (jonli ekanini bilish uchun)
        if (model) {
            model.rotation.x += 0.005;
            model.rotation.y += 0.01;
        }
        renderer.render(scene, camera);
    }

</script>
</body>
</html>